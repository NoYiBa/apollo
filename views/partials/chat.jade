.panel.right.animated(
    ng-show="client.isConnected()"
    ng-class="{ 'full': showFullChat, 'fadeOutRightBig': justLoggedOut }"
)
    
    ap-chat#chat(
        ap-drop="onDropUpload"
        ap-onscrolltop="loadBackMessages"
    )
        
        table#chat-table.table(ng-show="!showSettings")

            //- Messages
            tr.animated.fadeInUp.faster(ng-repeat="message in selectedChat.messages" ng-init="notSameFrom = message.from._id !== selectedChat.messages[$index -1].from._id")
                //- avatar for remote party
                td(width="60px")
                    img.img-circle(
                        style="width: 48px"
                        ap-avatar email="message.from.email"
                        ng-click="switchChat(message.from._id)"
                        ng-class="{ clickable: message.from._id !== account._id }"
                        ng-if="notSameFrom"
                    )

                td
                    h6(ng-if="notSameFrom") {{ message.from.display }}
                    ap-message(ap-content="message.content.text" ap-file="message.file")
                td.align-right(width="90px")
                    small: small.help-block {{ message.created | readableDate }}
                    

        //- Settings panel
        #settings.animated.fadeIn(ng-show="showSettings")
            include settings.jade

    .textarea-container(ng-show="selectedChat && selectedChat._id && !showSettings")
        
        //- display when someone is typing
        .chatstate
            img.img-circle(
                ng-repeat="(key, obj) in selectedChat.chatstate" ng-if="obj"
                style="width: 24px"
                ap-avatar email="recents[key].email"
                ng-class="{ 'animated swing infinite': obj.value === 'composing' }"
            )

        //- Macros
        mentio-menu#macros(
            mentio-typed-text="typedTerm"
            mentio-search="searchMacros(term)"
            mentio-select="selectedMacro(item)"
            mentio-for="'textInput'"
            mentio-trigger-char="':'"
            mentio-template-url="/partials/macros.html"
            mentio-items="macros | filter:label:typedTerm"
        )

        //- Mentioning somebody with @
        mentio-menu#mentions(
            mentio-typed-text="typedTerm"
            mentio-search="getMentionList(term)"
            mentio-select="selectedMention(item)"
            mentio-for="'textInput'"
            mentio-trigger-char="'@'"
            mentio-template-url="/partials/mentions.html"
            mentio-items="allRecents"
        )
        button.btn.btn-default(
            ap-upload="onDropUpload"
        ): i.fa.fa-upload
        textarea#textInput(
            ng-model="textInput"
            placeholder="Type text, markdown, paste images, or drag files"
            ap-enter="sendMessage(textInput); textInput = '';"
            ap-paste="onPasteUpload"
            ap-drop="onDropUpload"
            ng-keyup="isTyping()"
            
            mentio
            autocomplete="off"
        )



    //- Notifications

    .notify(ng-show="(activeCall && !hideCallPanel) || pendingUploads")
        
        //- File upload
        .middle.left(ng-show="pendingUploads")
            i.fa.fa-long-arrow-up
            | &nbsp;&nbsp;
            | Processing {{ pendingUploads }} {{ pendingUploads === 1 ? 'file' : 'files' }}...

        //- Call
        #audio-call-controls.middle.row(ng-show="activeCall && !hideCallPanel")
            .col-xs-7
                span(ng-show="!incomingCall && !callIsRinging") On a call with
                span(ng-show="callIsRinging") Placing a call to
                strong(style="display:block") {{ recents[activeCall.remoteEndpoint.id].display }}
                span(ng-show="incomingCall") is calling you

            .col-xs-5.align-right
                //- hang up
                button.btn.btn-default.btn-sm(ng-click="hangup()") Hang up
                
                //- answer
                button.btn.btn-default.btn-sm(
                    ng-click="answer();"
                    ng-show="incomingCall"
                ) Answer

                //- Join video call
                a.btn.btn-primary.btn-sm(
                    href="/private"
                    ng-show="activeCall.hasVideo"
                    target="_blank") Join video call
            
                
